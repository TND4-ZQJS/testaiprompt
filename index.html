<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Nomination Form â€” Web Filler</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
/* ====== Copied style from your pastebin reference ====== */
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;background:#f5f6f7;margin:0;padding:20px;}
.card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:16px;max-width:800px;margin:auto;}
h1{font-size:18px;margin:0 0 16px;}
label{display:block;margin:8px 0 4px;font-size:14px;color:#333;}
input[type="text"],select{width:100%;padding:8px 10px;border:1px solid #ccc;border-radius:6px;font-size:14px;}
.btn{display:inline-block;margin:6px 4px 0 0;padding:8px 16px;font-size:14px;border-radius:6px;border:1px solid #007aff;background:#007aff;color:#fff;cursor:pointer;}
.btn.ghost{background:#fff;color:#007aff;border:1px solid #007aff;}
.section{margin:20px 0;}
/* Signature modal */
#sigModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);align-items:center;justify-content:center;}
#sigBox{background:#fff;padding:16px;border-radius:8px;width:90%;max-width:500px;}
canvas{width:100%;height:200px;border:1px solid #ccc;border-radius:6px;display:block;}
</style>
</head>
<body>
<div class="card">
  <h1>Nomination Form</h1>

  <div class="section">
    <label for="PolicyNumber">Application/Policy Number</label>
    <input id="PolicyNumber" type="text" />
    <label for="ProposedInsured">Proposed Insured</label>
    <input id="ProposedInsured" type="text" />
    <label for="MaritalStatus">Marital Status</label>
    <select id="MaritalStatus">
      <option value="">-- Select --</option>
      <option>Single</option><option>Married</option>
      <option>Divorced</option><option>Widowed</option>
    </select>
    <label for="Religion">Religion</label>
    <select id="Religion">
      <option value="">-- Select --</option>
      <option>Muslim</option><option>Non-Muslim</option>
    </select>
  </div>

  <div class="section">
    <label>Signature of Life Insured</label>
    <button class="btn ghost" onclick="openSigPad('insured')">Sign</button>
    <div id="preview_insured"></div>

    <label>Signature of Witness</label>
    <button class="btn ghost" onclick="openSigPad('witness')">Sign</button>
    <div id="preview_witness"></div>
  </div>

  <div class="section">
    <button class="btn" onclick="downloadPDF()">Fill & Download PDF</button>
    <button class="btn ghost" onclick="resetAll()">Reset</button>
  </div>
</div>

<!-- Signature Modal -->
<div id="sigModal">
  <div id="sigBox">
    <p id="sigTitle"></p>
    <canvas id="sigCanvas"></canvas>
    <div style="margin-top:8px">
      <button class="btn" onclick="saveSig()">Save</button>
      <button class="btn ghost" onclick="clearSig()">Clear</button>
      <button class="btn ghost" onclick="closeSig()">Cancel</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script>
const NS="nominationForm";
const inputs=["PolicyNumber","ProposedInsured","MaritalStatus","Religion"];
inputs.forEach(id=>{
  const el=document.getElementById(id);
  el.value=localStorage.getItem(NS+":"+id)||"";
  el.addEventListener("input",()=>localStorage.setItem(NS+":"+id,el.value));
});

/* ===== Signature pad ===== */
let sigTarget=null,ctx=null,isDrawing=false,paths=[];
function openSigPad(target){
  sigTarget=target;
  document.getElementById("sigTitle").textContent="Sign: "+(target==="insured"?"Life Insured":"Witness");
  document.getElementById("sigModal").style.display="flex";
  const canvas=document.getElementById("sigCanvas");
  ctx=canvas.getContext("2d");
  resizeCanvas();
  restorePaths();
}
function resizeCanvas(){
  const c=document.getElementById("sigCanvas");
  c.width=c.clientWidth; c.height=c.clientHeight;
  redraw();
}
function redraw(){
  ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
  ctx.lineWidth=2; ctx.lineCap="round"; ctx.strokeStyle="#000";
  paths.forEach(p=>{
    ctx.beginPath();
    p.forEach((pt,i)=>{ i?ctx.lineTo(pt.x,pt.y):ctx.moveTo(pt.x,pt.y); });
    ctx.stroke();
  });
}
function clearSig(){paths=[];redraw();}
function saveSig(){
  localStorage.setItem(NS+":sig:"+sigTarget,JSON.stringify(paths));
  localStorage.setItem(NS+":sig:"+sigTarget+":png",ctx.canvas.toDataURL());
  showPreview(sigTarget);
  closeSig();
}
function showPreview(target){
  const png=localStorage.getItem(NS+":sig:"+target+":png");
  if(png) document.getElementById("preview_"+target).innerHTML=`<img src="${png}" style="max-height:60px">`;
}
function restorePaths(){
  const raw=localStorage.getItem(NS+":sig:"+sigTarget);
  paths=raw?JSON.parse(raw):[];
  redraw();
}
function closeSig(){document.getElementById("sigModal").style.display="none";}
document.getElementById("sigCanvas").addEventListener("mousedown",e=>{
  isDrawing=true;paths.push([{x:e.offsetX,y:e.offsetY}]);
});
document.getElementById("sigCanvas").addEventListener("mousemove",e=>{
  if(!isDrawing)return;
  paths[paths.length-1].push({x:e.offsetX,y:e.offsetY});
  redraw();
});
window.addEventListener("mouseup",()=>isDrawing=false);
["insured","witness"].forEach(showPreview);

/* ===== Reset ===== */
function resetAll(){
  if(!confirm("Reset all?"))return;
  inputs.forEach(id=>localStorage.removeItem(NS+":"+id));
  ["insured","witness"].forEach(t=>{
    localStorage.removeItem(NS+":sig:"+t);
    localStorage.removeItem(NS+":sig:"+t+":png");
    document.getElementById("preview_"+t).innerHTML="";
  });
  location.reload();
}

/* ===== PDF filler scaffold ===== */
async function downloadPDF(){
  const {PDFDocument,StandardFonts,rgb}=PDFLib;
  const pdfDoc=await PDFDocument.create();
  const page=pdfDoc.addPage([600,800]);
  const font=await pdfDoc.embedFont(StandardFonts.Helvetica);

  const v={
    PolicyNumber:PolicyNumber.value,
    ProposedInsured:ProposedInsured.value,
    MaritalStatus:MaritalStatus.value,
    Religion:Religion.value
  };
  let y=750;
  for(let k in v){ page.drawText(k+": "+v[k],{x:50,y,font,size:12,color:rgb(0,0,0)}); y-=20; }

  for(let t of ["insured","witness"]){
    const png=localStorage.getItem(NS+":sig:"+t+":png");
    if(png){
      const img=await pdfDoc.embedPng(png);
      page.drawImage(img,{x:50,y:y-60,width:120,height:50});
      page.drawText(t.toUpperCase(),{x:180,y:y-10,size:10,font});
      y-=80;
    }
  }

  const bytes=await pdfDoc.save();
  const blob=new Blob([bytes],{type:"application/pdf"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="NominationForm.pdf";a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
